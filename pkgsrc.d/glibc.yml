source:
  name: glibc
  subdir: 'ports'
  version: '2.42'
  
  url: 'https://ftp.gnu.org/gnu/glibc/glibc-2.42.tar.xz'
  format: 'tar.xz'
  extract-strip: 1

packages:
  - name: host-glibc
    version: '2.42'
    from_source: glibc
    tools-required:
      - tool: system-gcc
        stage-dependencies: [compiler]
    no-deps: true
    metadata:
      summary: GNU C Library
      description:  Contains the standard libraries that are used by nearly all programs on the system. This package includes shared versions of the standard C library and the standard math library, as well as many others. 
      essential: true

      website: 'https://www.gnu.org/software/libc/libc.html'
      maintainer: 'Yavuz Rao <racemus@hades-os.org>'
      section: core
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--buildtype=debugoptimized'
        - '--prefix=/usr'
        - '--cross-file'
        - '@SOURCE_ROOT@/cross_file.txt'
        - '-Ddisable_libgcc_dependency=true'
        - '-Dmlibc_no_headers=true'
        - '-Dlinux_kernel_headers=@BUILD_ROOT@/linux-headers/usr/include'

        - '@THIS_SOURCE_DIR@'
        environ:
          LDFLAGS: '-Wl,@THIS_SOURCE_DIR@/binaries/libgcc-x86_64.a'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'