tools:
  - name: host-autoconf-v2.69
    version: '2.69'
    source:
      name: autoconf-v2.69
      subdir: 'ports'
      url: 'https://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.xz'
      format: 'tar.xz'
      extract-path: 'autoconf-2.69'
      extract-strip: 1
      patch-path-strip: 3
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

  - name: host-automake-v1.16
    version: '1.16'
    source:
      name: automake-v1.16
      subdir: 'ports'
      version: '1.16.5'

      git: 'https://git.savannah.gnu.org/git/automake.git'
      tag: 'v1.16.5'

      tools-required:
        - host-autoconf-v2.69
      regenerate:
        - args: ['./bootstrap']
        - args: ['git', 'clone', 'https://github.com/autoconf-archive/autoconf-archive.git', '--branch=v2022.02.11', ' --depth=1']

    tools-required:
      - host-autoconf-v2.69
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
    compile:
      - args: ['make bin/aclocal-1.16 bin/automake-1.16 -j@PARALLELISM@', '&&', 'make -j@PARALLELISM@']
        environ:
            PATH: '@THIS_COLLECT_DIR@/bin'
        shell: True
    install:
      - args: ['make', 'install-strip']
      - args: ['ln', '-sf', '@PREFIX@/share/aclocal-1.16', '@PREFIX@/share/aclocal']
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/autoconf-archive/m4/.', '@PREFIX@/share/aclocal-1.16/']

  - name: host-binutils
    version: '2.43'
    from_source: binutils
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
        - '--target=@TARGET@'
        - '--with-sysroot=@SYSROOT_DIR@'
        - '--disable-werror'
        - '--disable-nls'
        - '--disable-dependency-tracking'
        environ:
          CFLAGS: '-O2 -pipe'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

      # GCC does *not* look for target-prefixed LD/AS.
      # Instead, it searches a list of prefix directories. Link AS/LD to make it happy.
      - args: ['mkdir', '-p', '@PREFIX@/@TARGET@/bin']
      - args: ['ln', '-sf', '@THIS_COLLECT_DIR@/@TARGET@/bin/as',
                            '@PREFIX@/@TARGET@/bin/as']
      - args: ['ln', '-sf', '@THIS_COLLECT_DIR@/@TARGET@/bin/ld',
                            '@PREFIX@/@TARGET@/bin/ld']

  - name: host-gcc
    version: '13.2.0'
    from_source: gcc
    tools-required:
      - tool: host-binutils
        recursive: true
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
        - '--target=@TARGET@'
        - '--with-sysroot=@SYSROOT_DIR@'
        - '--enable-languages=c,c++'
        - '--disable-multilib'
        - '--enable-initfini-array'
        - '--enable-shared'
        - '--enable-host-shared'
        # -g blows up GCC's binary size.
        environ:
          CFLAGS: '-O2 -pipe'
          CXXFLAGS: '-O2 -pipe'
    stages:
      - name: compiler
        pkgs-required:
         - mlibc-headers
        compile:
          - args: ['make', '-j@PARALLELISM@', 'all-gcc']
        install:
          - args: ['make', 'install-gcc']
      - name: libgcc
        tools-required:
          - tool: host-gcc
            stage-dependencies: [compiler]
        pkgs-required:
         - mlibc
        compile:
          - args: ['make', '-j@PARALLELISM@', 'all-target-libgcc']
        install:
          - args: ['make', 'install-target-libgcc']
      - name: libstdc++
        tools-required:
          - tool: host-gcc
            stage-dependencies: [libgcc]
        compile:
          - args: ['make', '-j@PARALLELISM@', 'all-target-libstdc++-v3']
        install:
          - args: ['make', 'install-target-libstdc++-v3']