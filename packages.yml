packages:
  - name: mlibc-headers
    version: '5.0'
    from_source: mlibc
    system-package: true
    metadata:
      summary: Managarm libc headers
      description: This package provides the headers for the C standard library that Hades uses.
      essential: true

      website: 'https://github.com/managarm/mlibc'
      maintainer: 'Yavuz Rao <yavuz.rao@gmail.com>'
      section: core
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--prefix=/usr'
        - '-Dheaders_only=true'
        - '--cross-file'
        - '@SOURCE_ROOT@/cross_file.txt'

        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: mlibc
    version: '5.0'
    from_source: mlibc
    tools-required:
      - tool: host-gcc
        stage-dependencies: [compiler]
    system-package: true
    metadata:
      summary: Managarm libc C library
      description: This package provides the C standard library that Hades uses, this includes the dynamic loader and various utility libraries.
      essential: true

      website: 'https://github.com/managarm/mlibc'
      maintainer: 'Yavuz Rao <yavuz.rao@gmail.com>'
      section: core
    pkgs-required:
      - mlibc-headers
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '-Ddisable_libgcc_dependency=true'
        - '--buildtype=debugoptimized'
        - '--prefix=/usr'
        - '--cross-file'
        - '@SOURCE_ROOT@/cross_file.txt'

        - '@THIS_SOURCE_DIR@'
        environ:
          LDFLAGS: '-Wl,@THIS_SOURCE_DIR@/binaries/libgcc-x86_64.a'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: bash
    version: '5.2'
    from_source: bash
    metadata:
      summary: The standard GNU Bourne again shell
      description: This package provides the Bourne-Again SHell.
      website: 'https://tiswww.case.edu/php/chet/bash/bashtop.html'
      maintainer: 'Yavuz Rao <yavuz.rao@gmail.com>'
      section: core
    tools-required:
      - host-gcc
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@TARGET@'
        - '--prefix=/usr'
        - '--without-bash-malloc'
        - '--disable-nls'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'install']
#
#  - name: coreutils
#    version: '8.32'
#    source:
#      name: 'coreutils-v8.32'
#      subdir: 'ports'
#      url: 'https://ftp.gnu.org/gnu/coreutils/coreutils-8.32.tar.xz'
#      format: 'tar.xz'
#      extract-strip: 1
#      extract-path: 'coreutils-8.32'
#      patch-path-strip: 3
#    tools-required:
#      - host-gcc
#    configure:
#      # Huge hack: coreutils does not compile the build-machine binary make-prime-list
#      # using the build-machine compiler. Hence, build and invoke the binary manually here.
#      - args:
#        - '@THIS_SOURCE_DIR@/configure'
#      - args: ['make', 'src/make-prime-list']
#      - args: ['./src/make-prime-list 5000 > @THIS_SOURCE_DIR@/src/primes.h']
#      - args: ['make', 'clean']
#      # No compile coreutils for the correct target.
#      - args:
#        - '@THIS_SOURCE_DIR@/configure'
#        - '--host=@TARGET@'
#        - '--prefix=/usr'
#        - 'CFLAGS=-DSLOW_BUT_NO_HACKS -Wno-error'
#    build:
#      - args: ['make', '-j@PARALLELISM@']
#      - args: ['make', 'install']
#        environ:
#          DESTDIR: '@THIS_COLLECT_DIR@'
#        quiet: true
#
#  - name: binutils
#    version: '2.43'
#    from_source: binutils
#    tools-required:
#      - tool: host-gcc
#    configure:
#      - args:
#        - '@THIS_SOURCE_DIR@/configure'
#        - '--host=@TARGET@'
#        - '--prefix=/usr'
#        - '--target=@TARGET@'
#        - '--with-sysroot=/'
#        - '--disable-nls'
#        # On recent compilers, binutils 2.26 causes implicit-fallthrough warnings, among others.
#        - '--disable-werror'
#        # -g blows up the binary size.
#        - 'CFLAGS=-O2 -pipe'
#    build:
#      - args: ['make', '-j@PARALLELISM@']
#      - args: ['make', 'install']
#        environ:
#          DESTDIR: '@THIS_COLLECT_DIR@'
#        quiet: true